<br/><p id="notice"><%= notice %></p>

<h1>Table des actions</h1>
<em>
  Cette table contient l'ensemble des actions.<br/>
  Une action ne correspond qu'à un seul thème (table "Thèmes") et qu'à un seul type (table "Types d'action").
</em>

<hr/>
<%-# Button to add a new action: at the top -%>
<%= link_to 'Ajouter une nouvelle action', new_action_path %>
<hr/>

<h3>Effectuer une recherche</h3><br/>
<%= form_tag(actions_path, method: :get) do %>

  <div class="field">
    Mot-clé cherché dans le titre, le nom de la photo, les descriptions de l'action, de l'impact et sur le temps :
    <%= text_field_tag :keyword, params[:keyword], size: '30', placeholder: 'Aucun mot-clé' %>
  </div>

  <div class="field">
    Nécessité d'une maison ?
    <%= select_tag :spot, options_for_select(['Indifférent', 'Oui', 'Non'], params[:spot]) %>
  </div>

  <div class="field">
    Investissement / Difficulté :
    <%= select_tag :investment, options_for_select([['Indifférent', '0'], ['Facile', '1'], ['Moyen', '2'], ['Difficile', '3']], params[:investment]) %>
  </div>

  <div class="field">
    Coût minimum :
    <%= number_field_tag :costmin, params[:costmin], step: 0.1, min: 0, max: 500, placeholder: 'Aucun' %>
  </div>

  <div class="field">
    Coût maximum :
    <%= number_field_tag :costmax, params[:costmax], step: 0.1, min: 0, max: 500, placeholder: 'Aucun' %>
  </div>

  <div class="field">
    Surface minimum :
    <%= number_field_tag :surfmin, params[:surfmin], step: 0.1, min: 0, max: 500, placeholder: 'Aucun' %>
  </div>

  <div class="field">
    Surface maximum :
    <%= number_field_tag :surfmax, params[:surfmax], step: 0.1, min: 0, max: 500, placeholder: 'Aucun' %>
  </div>

  <div class="field">
    Importance pour la biodiversité minimum :
    <%= number_field_tag :importmin, params[:importmin], step: 1, min: 0, max: 50, placeholder: 'Aucun' %>
  </div>

  <div class="field">
    Importance pour la biodiversité maximum :
    <%= number_field_tag :importmax, params[:importmax], step: 1, min: 0, max: 50, placeholder: 'Aucun' %>
  </div>

  <div class="field">
    Thème :
    <% themes = Theme.all %>
    <% themeoptions = ['Indifférent'] %>
    <% themes.each do |theme| %>
      <% themearray = [theme.title, theme.id] %>
      <% themeoptions.push(themearray) %>
    <% end %>
    <%= select_tag :theme_id, options_for_select(themeoptions, params[:theme_id]) %>
  </div>

  <div class="field">
    Type d'action :
    <% types = Type.all %>
    <% typeoptions = ['Indifférent'] %>
    <% types.each do |type| %>
      <% typearray = [type.title, type.id] %>
      <% typeoptions.push(typearray) %>
    <% end %>
    <%= select_tag :type_id, options_for_select(typeoptions, params[:type_id]) %>
  </div>

  <div class="actions">
    <%= submit_tag 'Rechercher', name: nil %>
  </div>

<% end %><br/>

<%= link_to 'Annuler la recherche', actions_path %><br/><br/>

<table class="table table-striped table-bordered table-hover">
  <thead>
    <tr>
      <th>Titre de l'action</th>
      <th>Thème</th>
      <th>Type d'action</th>
      <th>Description de l'action</th>
      <th>Description de l'impact de l'action</th>
      <th>Nécessité d'une maison ?</th>
      <th>Coût minimum [CHF]</th>
      <th>Temps minimum</th>
      <th>Unité de temps</th>
      <th>Description sur le temps</th>
      <th>Surface minimale</th>
      <th>Investissement / Difficulté</th>
      <th>Nom de la photo</th>
      <th>Importance pour la biodiversité</th>
      <th>Actions liées à la présente action</th>
      <th>Coûts qui composent l'action</th>
      <th>Espèces touchées par l'action</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <% @actions.each do |action| %>
      <tr>
        <td><%= action.title %></td>
        <td><%= action.theme.title %></td>
        <td><%= action.type.title %></td>
        <td><%= action.description %></td>
        <td><%= action.impact %></td>
        <td>
          <% if action.spot == true %>
            Oui
          <% else %>
            Non
          <% end %>
        </td>
        <td><%= action.cost_min %></td>
        <td><%= action.time_min %></td>
        <td>
          <% if action.time_unit == 1 %>
            Minute
          <% elsif action.time_unit == 2 %>
            Heure
          <% elsif action.time_unit == 3 %>
            Jour
          <% elsif action.time_unit == 4 %>
            Semaine
          <% elsif action.time_unit == 5 %>
            Mois
          <% else %>
            -
          <% end %>
        </td>
        <td><%= action.time_description %></td>
        <td><%= action.surface_min %></td>
        <td>
          <% if action.investment == 1 %>
            Facile
          <% elsif action.investment == 2 %>
            Moyen
          <% elsif action.investment == 3 %>
            Difficile
          <% else %>
            -
          <% end %>
        </td>
        <td><%= action.picture %></td>
        <td><%= action.importance %></td>
        <td><%= link_to 'Voir les différentes actions liées à cette action', actions_actions_url + '?utf8=✓&action_id=' + action.id.to_s %></td>
        <td><%= link_to 'Voir les différents coûts qui composent cette action', costs_url + '?utf8=✓&keyword=&costmin=&costmax=&action_id=' + action.id.to_s %></td>
        <td><%= link_to 'Voir les différentes espèces touchées par cette action', species_actions_url + '?utf8=✓&species_id=Indifférent&action_id=' + action.id.to_s %></td>
        <td>
          <%= link_to 'Editer', edit_action_path(action) %><br/>
          <%= link_to 'Supprimer', action, method: :delete, data: { confirm: 'Etes-vous sûr ? Attention : La suppression de cette action est irréversible et supprimera toutes les tâches associées.' } %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>